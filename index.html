<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDEAL DESIGN | æ™ºæ…§å ±åƒ¹èˆ‡è‡ªå‹•ç™¼ä¿¡ç³»çµ±</title>
    
    <!-- å¼•å…¥æ ¸å¿ƒå¥—ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- 1. æ–°å¢ EmailJS æ’ä»¶ (è‡ªå‹•ç™¼ä¿¡é—œéµ) -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Noto+Sans+TC:wght@300;400;700;900&display=swap');

        :root {
            --accent: #E87018; 
            --dark: #000000;
            --gray-bg: #121212;
            --border-muted: #333;
            --text-dim: #999;
        }

        body {
            background-color: #000;
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            margin: 0; padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- æ“ä½œé¢æ¿ --- */
        .admin-panel {
            width: 100%; max-width: 550px; background: var(--gray-bg); padding: 40px;
            border-radius: 16px; color: #FFF; box-shadow: 0 40px 80px rgba(0,0,0,0.6);
            margin-bottom: 60px;
        }
        .admin-panel h2 { font-weight: 900; letter-spacing: 1px; margin-bottom: 35px; text-align: center; font-size: 22px; }
        
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; font-size: 10px; color: #666; margin-bottom: 8px; letter-spacing: 1.5px; font-weight: 700; text-transform: uppercase; }
        .admin-panel input {
            width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border-muted);
            color: #FFF; padding: 10px 0; font-size: 15px; transition: 0.3s; box-sizing: border-box;
        }
        .admin-panel input:focus { border-color: var(--accent); outline: none; }

        .option-grid { display: grid; gap: 10px; margin-top: 10px; }
        .box {
            padding: 15px 20px; border: 1px solid var(--border-muted); border-radius: 8px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center; transition: 0.2s; font-size: 14px;
        }
        .box.active { border-color: var(--accent); background: rgba(232, 112, 24, 0.1); }
        .box .price { color: var(--accent); font-weight: 700; }

        .btn-main {
            width: 100%; background: var(--accent); color: white; border: none;
            padding: 18px; border-radius: 8px; font-weight: 800; font-size: 14px;
            cursor: pointer; margin-top: 35px; letter-spacing: 1px; transition: 0.3s;
        }
        .btn-main:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-main:disabled { background: #444; cursor: not-allowed; }

        /* --- PDF æ­£å¼æ¨£æ¿ --- */
        #pdf-template {
            position: absolute; left: -9999px; top: 0;
            width: 794px; height: 1123px; background: #FFFFFF; color: var(--dark);
            padding: 90px 80px; box-sizing: border-box; display: flex; flex-direction: column;
        }

        .pdf-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            border-bottom: 1.5px solid var(--dark); padding-bottom: 30px; margin-bottom: 50px;
        }
        .pdf-logo h1 { font-size: 28px; font-weight: 900; letter-spacing: 4px; margin: 0; line-height: 1; }
        .pdf-logo p { font-size: 10px; color: var(--accent); letter-spacing: 2.5px; font-weight: 700; margin-top: 10px; text-transform: uppercase; }
        
        .pdf-meta { text-align: right; font-size: 11px; color: #888; line-height: 1.6; }
        .pdf-meta b { color: var(--dark); font-size: 12px; letter-spacing: 0.5px; text-transform: uppercase; }

        .pdf-client { margin-bottom: 70px; }
        .pdf-label { font-size: 10px; font-weight: 800; color: var(--accent); letter-spacing: 1.5px; margin-bottom: 12px; text-transform: uppercase; }
        .pdf-client-name { font-size: 44px; font-weight: 900; margin: 0; letter-spacing: -1px; line-height: 1; }
        .pdf-client-email { font-size: 14px; color: #888; margin-top: 8px; }

        .pdf-table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }
        .pdf-table th { 
            text-align: left; font-size: 11px; padding: 15px 0; 
            border-bottom: 1px solid #EEE; color: var(--text-dim); letter-spacing: 1px; font-weight: 700;
        }
        .pdf-table th.col-right { text-align: right; }
        .pdf-table td { padding: 25px 0; font-size: 16px; border-bottom: 1px solid #F5F5F5; }
        .col-right { text-align: right; font-weight: 700; font-size: 18px; }

        .pdf-total-wrap { display: flex; flex-direction: column; align-items: flex-end; margin-bottom: 90px; }
        .pdf-total-label { font-size: 11px; font-weight: 700; color: var(--text-dim); margin-bottom: 10px; letter-spacing: 1px; }
        .pdf-total-amount { font-size: 52px; font-weight: 900; color: var(--dark); letter-spacing: -1.5px; line-height: 1; }
        .pdf-total-amount span { font-size: 22px; vertical-align: middle; margin-right: 10px; color: var(--accent); }

        .pdf-terms { margin-top: 20px; }
        .pdf-terms-title { 
            display: inline-block; background: var(--dark); color: #FFF;
            font-size: 10px; font-weight: 800; padding: 6px 14px; letter-spacing: 1.5px; margin-bottom: 25px;
            text-transform: uppercase;
        }
        .terms-list { margin: 0; padding: 0; list-style: none; }
        .terms-list li { 
            font-size: 12px; color: #444; line-height: 2; border-bottom: 1px solid #F9F9F9; padding: 10px 0;
            display: flex; align-items: flex-start;
        }
        .terms-list b { color: var(--dark); width: 35px; flex-shrink: 0; }

        .pdf-footer { 
            position: absolute; bottom: 65px; left: 0; right: 0;
            text-align: center; font-size: 11px; letter-spacing: 8px; 
            color: #CCC; font-weight: 400; text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="admin-panel">
    <h2>æ™ºæ…§å ±åƒ¹ç™¼ä¿¡ç³»çµ±</h2>
    
    <div class="input-group">
        <label>å®¢æˆ¶åç¨± / CLIENT NAME</label>
        <input type="text" id="inputName" placeholder="è«‹è¼¸å…¥å°è±¡ç¨±å‘¼">
    </div>

    <div class="input-group">
        <label>é›»å­éƒµä»¶ / EMAIL (å¿…å¡«ï¼Œå°‡ç™¼é€å ±åƒ¹å–®è‡³æ­¤)</label>
        <input type="email" id="inputEmail" placeholder="æ”¶ä»¶äººä¿¡ç®±">
    </div>

    <div class="input-group">
        <label>1. é¸æ“‡æ–¹æ¡ˆ / SELECT PLAN</label>
        <div class="option-grid">
            <div class="box plan" onclick="selectPlan(10000, 'ä¼æ¥­å…¨æ¡ˆè¦åŠƒ (Premium Branding)', this)">
                <span>ä¼æ¥­å…¨æ¡ˆè¦åŠƒ</span><span class="price">$10,000</span>
            </div>
            <div class="box plan" onclick="selectPlan(8000, 'å•†æ¥­å“ç‰Œæ–¹æ¡ˆ (Pro)', this)">
                <span>å•†æ¥­å“ç‰Œæ–¹æ¡ˆ</span><span class="price">$8,000</span>
            </div>
            <div class="box plan" onclick="selectPlan(6000, 'ç¶“å…¸è­˜åˆ¥æ–¹æ¡ˆ (Classic)', this)">
                <span>ç¶“å…¸è­˜åˆ¥æ–¹æ¡ˆ</span><span class="price">$6,000</span>
            </div>
        </div>
    </div>

    <div class="input-group">
        <label>2. åŠ è³¼æœå‹™ / ADD-ONS</label>
        <div class="option-grid">
            <div class="box addon" onclick="toggleAddon(1500, 'åç‰‡è¨­è¨ˆ (å–®é¢)', this)">
                <span>åç‰‡è¨­è¨ˆ (å–®é¢)</span><span class="price">+$1,500</span>
            </div>
            <div class="box addon" onclick="toggleAddon(2000, 'åç‰‡è¨­è¨ˆ (é›™é¢)', this)">
                <span>åç‰‡è¨­è¨ˆ (é›™é¢)</span><span class="price">+$2,000</span>
            </div>
            <div class="box addon" onclick="toggleAddon(2000, 'æ€¥ä»¶è™•ç† (12H Express)', this)">
                <span>æ€¥ä»¶è™•ç† (12H)</span><span class="price">+$2,000</span>
            </div>
        </div>
    </div>
    
    <button class="btn-main" id="genBtn" onclick="fullAutomationProcess()">ç”Ÿæˆå ±åƒ¹å–®ä¸¦è‡ªå‹•å¯„ä¿¡çµ¦å®¢æˆ¶ ğŸš€</button>
</div>

<div id="pdf-template">
    <!-- PDF å…§å®¹ä¿æŒä¸è®Šï¼Œèˆ‡æ‚¨æä¾›çš„æ¨£å¼ä¸€è‡´ -->
    <div class="pdf-header">
        <div class="pdf-logo">
            <h1>IDEAL DESIGN</h1>
            <p>Creative Strategy Studio</p>
        </div>
        <div class="pdf-meta">
            <b>Official Quotation</b><br>
            NO: #ID-2026-001<br>
            DATE: <span id="pdfDate"></span><br>
            VALID: 14 Days
        </div>
    </div>
    
    <div class="pdf-client">
        <div class="pdf-label">Prepared For</div>
        <h2 class="pdf-client-name" id="pdfName">CLIENT NAME</h2>
        <div class="pdf-client-email" id="pdfEmail">---</div>
    </div>

    <table class="pdf-table">
        <thead>
            <tr>
                <th>é …ç›®æè¿° DESCRIPTION</th>
                <th class="col-right">é‡‘é¡ TOTAL (TWD)</th>
            </tr>
        </thead>
        <tbody id="pdfItemsBody"></tbody>
    </table>
    
    <div class="pdf-total-wrap">
        <div class="pdf-total-label">é ç®—ç¸½è¨ˆ ESTIMATED TOTAL</div>
        <div class="pdf-total-amount"><span>NT$</span><span id="pdfTotal">0</span></div>
    </div>

    <div class="pdf-terms">
        <div class="pdf-terms-title">Terms & Conditions æœå‹™é ˆçŸ¥</div>
        <ul class="terms-list">
            <li><b>01</b> æ•ˆåŠ›ï¼šæœ¬å ±åƒ¹å–®ç”±æ™ºæ…§è‡ªå‹•åŒ–ç³»çµ±ç”Ÿæˆï¼Œæœ€çµ‚è¦æ ¼èˆ‡æ¢æ¬¾è«‹ä»¥æ­£å¼ç°½ç½²ä¹‹è¨­è¨ˆåˆç´„ç‚ºæº–ã€‚</li>
            <li><b>02</b> æ™‚ç¨‹ï¼šç¢ºèªåˆä½œå¾Œè«‹å›è¦†æœ¬éƒµä»¶ï¼Œæˆ‘å€‘å°‡ç‚ºæ‚¨å®‰æ’å°ˆå±¬è¨­è¨ˆå¸«å°æ¥èˆ‡æ­£å¼é–‹å·¥æ’ç¨‹ã€‚</li>
            <li><b>03</b> ç‰ˆæ¬Šï¼šæœ¬å°ˆæ¡ˆæ‰€æœ‰è¨­è¨ˆä¹‹å•†æ¥­ç‰ˆæ¬Šæ–¼å°¾æ¬¾çµæ¸…å¾Œï¼Œæ­£å¼ç”±è‰¾è¿ªå…’å‰µæ„è¨­è¨ˆè½‰è®“äºˆå®¢æˆ¶ã€‚</li>
        </ul>
    </div>

    <div class="pdf-footer">STRATEGY &nbsp; | &nbsp; DESIGN &nbsp; | &nbsp; IDENTITY &nbsp; | &nbsp; 2026</div>
</div>

<script>
    // 2. åˆå§‹åŒ– EmailJS (è«‹å‹™å¿…æª¢æŸ¥æ­¤è™•æ˜¯å¦ç‚ºæ‚¨çš„æ­£ç¢º Public Key)
    (function(){
        emailjs.init("X9BD_2FQwj7cnXNZM"); 
    })();

    let selectedPlan = { name: "", price: 0 };
    let selectedAddons = [];

    function selectPlan(price, name, el) {
        document.querySelectorAll('.plan').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        selectedPlan = { name, price };
    }

    function toggleAddon(price, name, el) {
        el.classList.toggle('active');
        const index = selectedAddons.findIndex(a => a.name === name);
        if (index > -1) selectedAddons.splice(index, 1);
        else selectedAddons.push({ name, price });
    }

    async function fullAutomationProcess() {
        const name = document.getElementById('inputName').value;
        const email = document.getElementById('inputEmail').value;
        const btn = document.getElementById('genBtn');

        if(!name || !email || selectedPlan.price === 0) {
            alert("è«‹å¡«å¯«å§“åã€é›»å­éƒµä»¶ä¸¦é¸æ“‡ä¸€å€‹æ–¹æ¡ˆï¼");
            return;
        }

        btn.innerText = "æ­£åœ¨è™•ç†è‡ªå‹•åŒ–æµç¨‹ (PDF + Email)...";
        btn.disabled = true;

        try {
            // --- æ­¥é©Ÿ A: æ›´æ–° PDF æ¨£æ¿å…§å®¹ ---
            document.getElementById('pdfName').innerText = name.toUpperCase();
            document.getElementById('pdfEmail').innerText = email;
            document.getElementById('pdfDate').innerText = new Date().toISOString().split('T')[0].replace(/-/g, '.');
            
            let total = selectedPlan.price;
            let rows = `<tr><td>${selectedPlan.name}</td><td class="col-right">$${selectedPlan.price.toLocaleString()}</td></tr>`;
            selectedAddons.forEach(a => {
                total += a.price;
                rows += `<tr><td style="color:#666; font-size:14px;">+ ${a.name}</td><td class="col-right">$${a.price.toLocaleString()}</td></tr>`;
            });
            document.getElementById('pdfItemsBody').innerHTML = rows;
            document.getElementById('pdfTotal').innerText = total.toLocaleString();

            // --- æ­¥é©Ÿ B: ç”Ÿæˆ PDF æª”æ¡ˆ ---
            const template = document.getElementById('pdf-template');
            template.style.left = "0";
            template.style.position = "relative";

            const canvas = await html2canvas(template, { 
                scale: 3, 
                useCORS: true, 
                backgroundColor: "#FFFFFF",
                logging: false
            });
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            
            template.style.left = "-9999px";
            template.style.position = "absolute";

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
            
            // ä¸‹è¼‰ PDF çµ¦å®¢æˆ¶
            pdf.save(`IDEAL_QUOTE_${name.replace(/\s+/g, '_')}.pdf`);

            // --- æ­¥é©Ÿ C: åŸ·è¡Œå›å‚³ç³»çµ± (ç™¼é€ Email) ---
            // é€™è£¡å°‡è³‡æ–™å‚³é€åˆ° EmailJS æ¨¡æ¿
            await emailjs.send("service_0r0svte", "template_gydfl1a", {
                to_name: name,
                to_email: email,
                total_price: total.toLocaleString(),
                details: selectedPlan.name + (selectedAddons.length > 0 ? " ç­‰åŠ è³¼é …ç›®" : ""),
                message: "æ­£å¼å ±åƒ¹å–®å·²ä¸‹è¼‰å®Œæˆï¼Œæ­¡è¿å›è¦†æ­¤ä¿¡ä»¶å•Ÿå‹•åˆä½œã€‚"
            });

            alert("âœ¨ å ±åƒ¹å–®å·²æˆåŠŸå¯„é€åˆ°å®¢æˆ¶ä¿¡ç®±ï¼\n(è«‹è¨˜å¾—æª¢æŸ¥æ‚¨çš„å‰¯æœ¬ä¿¡ç®±)");

        } catch (error) {
            console.error("ç™¼ä¿¡å¤±æ•—:", error);
            alert("PDF ç”ŸæˆæˆåŠŸï¼Œä½†ç™¼ä¿¡éç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– ID è¨­å®šã€‚");
        } finally {
            btn.innerText = "ç”Ÿæˆå ±åƒ¹å–®ä¸¦è‡ªå‹•å¯„ä¿¡çµ¦å®¢æˆ¶ ğŸš€";
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
